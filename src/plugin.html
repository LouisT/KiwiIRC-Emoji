<!--

   [{{:buildmode|UNKOWN}}] Plugin updated {{:date|UNKNOWN}} with {{:count|0}} emojis.

-->
<script src="{{:baseurl|https://twemoji.maxcdn.com}}/twemoji.min.js"></script>
<style>
    #kiwi .emojiPreview {
        position: absolute;
        background: #3c3b37;
        margin-right: 280px;
        padding: 5px;
        width: 67px;
        height: 67px;
        z-index: 1000;
        border-bottom-left-radius: 1em;
        border-top-left-radius: 1em;
    }
    #kiwi .emojiPreview img {
        width: 100%;
        height: 100%;
    }
    #kiwi .emojiMenu {
        position: absolute;
        background: #3c3b37;
        padding: 5px;
        padding-bottom: 0px;
        margin-right: 13px;
        width: 260px;
        border-top-right-radius: 1em;
        border-top-left-radius: 1em;
        text-align: center;
        z-index: 1000;
    }
    #kiwi .emojiMenu .emojiToggle {
        display: inline-block;
        width: 15px;
        height: 25px;
        cursor: pointer;
        margin-right: 5px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    #kiwi .emojiList {
        position: absolute;
        background: #3c3b37;
        padding: 5px;
        width: 273px;
        overflow-y: scroll;
        max-height: 40%;
        z-index: 1000;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    #kiwi .emojiList .emoji {
        display: inline-block;
        width: 20px;
        height: 20px;
        cursor: pointer;
        margin-right: 3px;
        margin-left: 3px;
    }
</style>
<script type="text/html" id="tmpl_emojilist">
 <div class="emojiPreview">
   <img class="emojiPreImg" src="{{:baseurl|https://twemoji.maxcdn.com}}/36x36/1f600.png" />
 </div>
 <div class="emojiMenu">{{:emojiToggles|NOT FOUND}}</div>
 <div class="emojiList">{{:emojiTabs|NOT FOUND}}</div>
</script>
<script>
var emojis = {
{{:emojis|    t0: []}}
};
(function() {
        var $list = $($('#tmpl_emojilist').html()),
            $icon = $('<a><img src="{{:baseurl|https://twemoji.maxcdn.com}}/16x16/1f600.png" alt="smile" style="width:23px;height:23px;" /></a>');
        $icon.on('click', function(event) {
            event.stopPropagation();
            $list.appendTo($('#kiwi')).show().css({bottom: ($('.controlbox').outerHeight())+'px', right: 0});
            function positionEmoji () {
                     $height = $('.controlbox').outerHeight()+$('.emojiList').outerHeight();
                     $('.emojiMenu').css({bottom: ($height-4)+'px', right: 0});
                     $('.emojiPreview').css({bottom: ($height-77)+'px', right: 0});
            };
            positionEmoji();
            if (!$list.attr('shown')) {
               $list.attr('shown','true');
               $(window).resize(function() {
                   positionEmoji();
               });
               $epreimg = $('.emojiPreImg');
               $epreimg.attr('src',$epreimg.attr('src')).attr('defimg',$epreimg.attr('src'));
               $('.emojiToggle').click(function (event) {
                   event.stopPropagation();
                   $('.emojiToggle').css('color','#666');
                   $(this).css('color','white');
                   var $target = $(this).attr('target'),
                       $sel = $('#'+$target);
                   $('.emojiTab').hide();
                   $sel.show();
                   if (!$sel.attr('shown')) {
                      $sel.attr('shown','true');
                      _.each(emojis[$target],function (emoji) {
                          $sel.append('<img src="{{:baseurl|https://twemoji.maxcdn.com}}/36x36/'+emoji+'.png" alt="e" data-text="'+emoji+'" class="emoji" />');
                      });
                      $('.emoji').hover(function () {
                          $('.emojiPreImg').attr('src',$(this).attr('src'));
                      },function(){
                          $('.emojiPreImg').attr('src',$('.emojiPreImg').attr('defimg'));
                      });
                   }
                   positionEmoji();
               });
               $('.emojiInit').trigger('click');
            }
            $('.emojiList, .emojiPreview, .emojiMenu').on('click',function (event) {
                event.stopPropagation();
            });
        });
        $list.on('click', '.emoji', function(event) {
            event.stopPropagation();
            var $inp = $('.controlbox .inp'),
                txt = document.createElement("textarea");
            txt.innerHTML = $(this).data('text').split('-').map(function(v) { return '&#x'+v+';'; }).join('');
            $inp.val($inp.val() + txt.value + ' ');
        });
        $(document).on('click', function() {
            $list.hide();
        });
        var control = kiwi.components.ControlInput();
        control.addPluginIcon($icon);
        kiwi.events.on('message:display', function (event, data) {
            if (/^(action|privmsg|notice)$/i.test(data.message.type)) {
               data.message.msg = twemoji.parse(data.message.msg, { size: '16x16' });
            }
        });
})();
</script>
